<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LOTRO Warden Rota Planner</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <div id="app">

    <!-- ============================================
         MOBILE CONTROLS
         ============================================ -->
    <div id="mobile-controls">
      <button id="toggle-timeline-btn" class="active">Timeline: ON</button>
      <button id="toggle-tooltips-btn" class="active">Tester: ON</button>
    </div>

    <!-- ============================================
         LEFT SIDEBAR - PALETTE
         ============================================ -->
    <aside id="palette">
      
      <!-- Masteries Section -->
      <section class="palette-section">
        <h2>Masteries</h2>
        <div id="mastery-list"></div>
      </section>

      <!-- Basic Skills Section -->
      <section class="palette-section">
        <h2>Gambit Builder</h2>
        <div id="skill-list"></div>
      </section>

      <!-- Cooldown Control Section -->
      <section class="palette-section">
        <h2>Mastery Cooldown</h2>
        <input type="range" id="cd-slider" min="0.5" max="15" step="0.5" value="5">
        <div id="cd-value">5.0s</div>
      </section>

    </aside>

    <!-- ============================================
         MAIN AREA - TIMELINE
         ============================================ -->
    <main id="timeline-area">

      <!-- Timeline Controls -->
      <div id="controls">
        <h2 class="timeline-title">Timeline</h2>

        <!-- Playback Controls -->
        <div class="control-group">
          <button title="Clear all timeline slots">Clear</button>
          <button title="Remove last added item">Undo</button>
          <button title="Reverse last change">Reverse</button>
          <button id="add-slot-btn" title="Add new timeline slot">+ Slot</button>
        </div>

        <!-- Player Controls -->
        <div class="control-group">
          <button title="Start playback">Play</button>
          <button title="Pause playback">Pause</button>
          <button title="Stop and reset playback">Stop</button>
        </div>

        <!-- Import/Export -->
        <div class="control-group">
          <button title="Export timeline to file">Export</button>
          <button title="Import timeline from file">Import</button>
        </div>

        <!-- Character Configuration -->
        <div class="control-group">
          <button id="character-btn" title="Configure traits and traceries">
            Character Traits/Traceries
          </button>
        </div>

        <!-- Preset Management -->
        <div class="control-group">
          <select id="preset-selector">
            <option value="" disabled selected>Select Preset...</option>
          </select>
          <button id="load-preset-btn" title="Load selected preset">Load</button>
          <button id="save-preset-btn" title="Save current timeline as preset">Save New</button>
          <button id="delete-preset-btn" title="Delete selected preset">Delete</button>
        </div>

        <!-- Timer Display -->
        <div id="timer">00:00.0</div>
      </div>

      <!-- Timeline Grid -->
      <div id="timeline">
        <!-- Timeline slots generated dynamically by JavaScript -->
      </div>

    </main>

    <!-- ============================================
         CENTER SIDEBAR - ACTIVE EFFECTS
         ============================================ -->
    <aside id="active-effects">
      <h3>Active Effects</h3>
      <div id="effects-list"></div>
    </aside>

    <!-- ============================================
         RIGHT SIDEBAR - TOOLTIPS & TESTER
         ============================================ -->
    <aside id="tooltips">

      <!-- Timeline Tooltip Box -->
      <div class="tooltip-box">
        <h3>Timeline Preview</h3>
        <div class="tooltip-content" id="timelinetooltip"></div>
      </div>

      <!-- Character Configuration Panel (Modal) -->
      <div id="character-panel" hidden>
        <div class="panel-header">
          <h2>Character Configuration</h2>
          <button id="close-character" aria-label="Close panel">‚úï</button>
        </div>
        <div class="panel-content">
          <div class="panel-section">
            <h3>Traits</h3>
            <div id="traits-list"></div>
          </div>
          <div class="panel-section">
            <h3>Traceries</h3>
            <div id="traceries-list"></div>
          </div>
        </div>
      </div>

      <!-- Gambit Tester -->
      <div id="gambit-tester">
        
        <div class="gambit-header">
          Gambit Tester
        </div>

        <!-- Input Slots -->
        <div class="gambit-slots">
          <div class="gambit-slot" data-index="0"></div>
          <div class="gambit-slot" data-index="1"></div>
          <div class="gambit-slot" data-index="2"></div>
          <div class="gambit-slot" data-index="3"></div>
          <div class="gambit-slot" data-index="4"></div>

          <!-- Tester Controls -->
          <div class="gambit-controls">
            <button id="gambit-back" title="Remove last input">‚Üê</button>
            <button id="gambit-clear" title="Clear all inputs">üóë</button>
          </div>
        </div>

        <!-- Tester Tooltip Display -->
        <div class="gambit-tooltip">
          <img
            id="gambit-tooltip-icon"
            src=""
          />
          <div id="gambit-duration"></div>
          <a
            id="gambit-tooltip-link"
            href="#"
            target="_blank"
            rel="noopener noreferrer"
            hidden
          >
            Open Wiki ‚Üí
          </a>
        </div>

      </div>

    </aside>

  </div>

  <!-- ============================================
       LEGEND POPUP
       ============================================ -->
  <div id="legend-toggle" role="button" tabindex="0">
    ‚ÑπÔ∏è Explanation / Legend
  </div>

  <div id="legend-popup" hidden role="dialog" aria-labelledby="legend-title">
    <div class="container">
      <h1 id="legend-title">üõ°Ô∏è Warden Rota Planner</h1>
      <p class="subtitle">Complete Guide & Legend</p>
      
      <div class="section">
        <h2>üìã Overview</h2>
        <p>The Warden Rota Planner is a visual tool for planning and testing Warden skill rotations in LOTRO. Build your rotation, test gambit sequences, and simulate playback with real-time cooldown tracking.</p>
      </div>
  
      <div class="section">
        <h2>üéÆ Basic Skills</h2>
        <div class="skill-row">
          <div class="skill-icon">1</div>
          <div>
            <strong style="color: #4fc3f7;">Spear</strong><br>
            <span style="color: #888;">0.5s cast time</span>
          </div>
        </div>
        <div class="skill-row">
          <div class="skill-icon">2</div>
          <div>
            <strong style="color: #4fc3f7;">Shield</strong><br>
            <span style="color: #888;">0.5s cast time</span>
          </div>
        </div>
        <div class="skill-row">
          <div class="skill-icon">3</div>
          <div>
            <strong style="color: #4fc3f7;">Fist</strong><br>
            <span style="color: #888;">0.5s cast time</span>
          </div>
        </div>
        <div class="skill-row">
          <div class="skill-icon">4</div>
          <div>
            <strong style="color: #4fc3f7;">Execute</strong><br>
            <span style="color: #888;">0.8s cast time - Executes the gambit sequence</span>
          </div>
        </div>
      </div>
  
      <div class="section">
        <h2>üîß Timeline Builder</h2>
        
        <h3>How to Use:</h3>
        <ul>
          <li><strong>Drag & Drop:</strong> Drag skills or masteries from the palette onto timeline slots</li>
          <li><strong>Build Sequence:</strong> Add skills (1, 2, 3) to build gambits, then Execute (4) to trigger them</li>
          <li><strong>Masteries:</strong> Quick shortcuts for common skill combinations (e.g., "12" = Spear + Shield)</li>
          <li><strong>Auto-Expand:</strong> Timeline automatically adds slots as you fill them (max 200)</li>
        </ul>
  
        <div class="tip">
          <strong>üí° Tip:</strong> Use masteries to save time! Instead of dragging "1" then "2", just drag "12" mastery.
        </div>
  
        <h3>Timeline Controls:</h3>
        <div class="feature-grid">
          <div class="feature-card">
            <h4>Play ‚ñ∂Ô∏è</h4>
            <p>Start executing the rotation from the beginning</p>
          </div>
          <div class="feature-card">
            <h4>Pause ‚è∏Ô∏è</h4>
            <p>Pause execution at current position</p>
          </div>
          <div class="feature-card">
            <h4>Stop ‚èπÔ∏è</h4>
            <p>Stop and reset to beginning</p>
          </div>
          <div class="feature-card">
            <h4>Clear üóëÔ∏è</h4>
            <p>Delete entire timeline</p>
          </div>
          <div class="feature-card">
            <h4>Undo ‚Ü∂</h4>
            <p>Remove last added skill/mastery</p>
          </div>
          <div class="feature-card">
            <h4>Reverse ‚ü≤</h4>
            <p>Undo last change (restores previous state)</p>
          </div>
        </div>
      </div>
  
      <div class="section">
        <h2>‚öîÔ∏è Gambit Tester</h2>
        <p>Test gambit combinations in real-time without building a full rotation.</p>
        
        <h3>Features:</h3>
        <ul>
          <li><strong>Live Preview:</strong> See the resulting gambit as you build</li>
          <li><strong>Duration Display:</strong> Shows buff/DoT/HoT duration (affected by your character config)</li>
          <li><strong>Wiki Links:</strong> Quick access to gambit information</li>
          <li><strong>Back/Clear:</strong> Remove last input or reset completely</li>
        </ul>
  
        <div class="info">
          <strong>‚ÑπÔ∏è Info:</strong> The tester recognizes gambits automatically as you add skills. Valid gambits need at least 2 skills.
        </div>
  
        <h3>Limitations:</h3>
        <div class="limitation">
          <strong>‚ö†Ô∏è Maximum Inputs:</strong>
          <ul style="margin-top: 5px;">
            <li>Basic Skills: Max 5 (e.g., 1-2-3-1-2)</li>
            <li>Masteries: Max 3 (e.g., 12-23-31)</li>
            <li>Combined: Follows the rules above</li>
          </ul>
        </div>
      </div>
  
      <div class="section">
        <h2>‚è±Ô∏è Playback System</h2>
        
        <h3>Visual Feedback:</h3>
        <table>
          <tr>
            <th>Status</th>
            <th>Meaning</th>
          </tr>
          <tr>
            <td><span style="color: #4f9;">‚úì Green</span></td>
            <td>Skill/Gambit executed successfully</td>
          </tr>
          <tr>
            <td><span style="color: #f44;">‚úó Red</span></td>
            <td>Failed - Mastery on cooldown</td>
          </tr>
          <tr>
            <td><span style="color: #4fc3f7;">Timer</span></td>
            <td>Shows total rotation time (MM:SS.s)</td>
          </tr>
        </table>
  
        <h3>Mastery Cooldowns:</h3>
        <ul>
          <li>Adjustable via slider (default cooldown time)</li>
          <li>Visual overlay shows remaining cooldown on palette items</li>
          <li>Countdown updates in real-time during playback</li>
          <li>Red border in timeline if mastery used during cooldown</li>
        </ul>
      </div>
  
      <div class="section">
        <h2>üß© Character Configuration</h2>
        <div class="feature-grid">
          <div class="feature-card">
            <h4>Traits</h4>
            <ul style="margin: 5px 0 0 15px;">
              <li>Blue Line: +10s Shield buffs</li>
              <li>Yellow Line: +10s Fist buffs</li>
              <li>Red Line: +5s Bleed DoTs</li>
            </ul>
          </div>
          <div class="feature-card">
            <h4>Traceries</h4>
            <ul style="margin: 5px 0 0 15px;">
              <li>Shield Buff: +11s</li>
              <li>Shield Tactics: +11s</li>
              <li>Gambit Debuff: +11s</li>
              <li>Fist DoT: +8s</li>
              <li>Spear DoT: +8s</li>
            </ul>
          </div>
        </div>
  
        <div class="info">
          <strong>‚ÑπÔ∏è Note:</strong> Settings are saved automatically and affect both the Gambit Tester and Active Effects display.
        </div>
      </div>
  
      <div class="section">
        <h2>üíæ Import/Export & Presets</h2>
        
        <h3>Save Your Work:</h3>
        <ul>
          <li><strong>Export:</strong> Save timeline as <code>.txt</code> file</li>
          <li><strong>Import:</strong> Load previously saved timeline</li>
          <li><strong>Presets:</strong> Quick-load common rotations</li>
        </ul>
  
        <h3>Default Presets:</h3>
        <div class="feature-grid">
          <div class="feature-card">
            <h4>Blue (Tank)</h4>
            <p>Defensive rotation with War-cry opener and Restoration chain</p>
          </div>
          <div class="feature-card">
            <h4>Red (DPS)</h4>
            <p>Offensive rotation with Offensive Strike and Brink of Victory</p>
          </div>
        </div>
  
        <h3>Custom Presets:</h3>
        <ul>
          <li><strong>Save Preset:</strong> Store current timeline with custom name</li>
          <li><strong>Load Preset:</strong> Select and load any saved preset</li>
          <li><strong>Delete Preset:</strong> Remove custom presets (default presets protected)</li>
        </ul>
  
        <div class="warning">
          <strong>‚ö†Ô∏è Note:</strong> Custom presets are stored in browser localStorage. Clearing browser data will delete them!
        </div>
      </div>
  
      <div class="section">
        <h2>üì± Mobile Support</h2>
        <p>Toggle buttons to show/hide sections on smaller screens:</p>
        <ul>
          <li><strong>Timeline Toggle:</strong> Show/hide timeline builder</li>
          <li><strong>Tester Toggle:</strong> Show/hide gambit tester</li>
        </ul>
        <div class="tip">
          <strong>üí° Tip:</strong> On mobile, use portrait mode for palette access and landscape for timeline view.
        </div>
      </div>
  
      <div class="section">
        <h2>üö´ Known Limitations</h2>
        <div class="limitation">
          <ul>
            <li>Maximum 200 timeline slots (technical limit)</li>
            <li>Gambit tester: 5 basic skills OR 3 masteries max</li>
            <li>No validation for actual in-game skill availability</li>
            <li>Cooldowns are visual approximations only</li>
            <li>Does not account for haste, lag, or player reaction time</li>
          </ul>
        </div>
      </div>
  
      <div class="section">
        <h2>‚ùì Frequently Asked Questions</h2>
        
        <h3>Q: Why did my mastery turn red?</h3>
        <p><strong>A:</strong> The mastery is still on cooldown. Check the cooldown timer on the palette or increase cooldown time via slider.</p>
        
        <h3>Q: How do I know which gambit I built?</h3>
        <p><strong>A:</strong> During playback, the Timeline Tooltip shows your current build and executed gambits with icons.</p>
        
        <h3>Q: Can I reorder skills in the timeline?</h3>
        <p><strong>A:</strong> Not directly. Use Undo to remove and re-add, or export, edit the JSON, and re-import.</p>
        
        <h3>Q: Why isn't my custom preset showing?</h3>
        <p><strong>A:</strong> Ensure you clicked "Save Preset" and gave it a unique name. Check that localStorage isn't disabled.</p>
        
        <h3>Q: What's the difference between Undo and Reverse?</h3>
        <p><strong>A:</strong> Undo removes the last added item. Reverse restores the entire previous state (like Ctrl+Z).</p>
      </div>
  
      <div class="section">
        <h2>üéØ Best Practices</h2>
        <div class="tip">
          <ul>
            <li>Use masteries to accelerate gambit building.</li>
            <li>Save presets for common rotations to iterate faster.</li>
            <li>Monitor cooldown overlays to avoid failed masteries.</li>
            <li>Leverage the tester for quick gambit duration checks.</li>
          </ul>
        </div>
      </div>
    </div>
    <button id="close-legend">Close</button>
  </div>

  <!-- ============================================
       SCRIPTS
       ============================================ -->
  <script src="gambits.js"></script>
  <script src="wardenrota.js"></script>

</body>
</html>
